(ns forms-example.handler
  (:require [compojure.core :refer [GET defroutes]]
            [noir.util.middleware :refer [app-handler]]
            [noir.response :as noir]
            [compojure.route :as route]
            [selmer.parser :as parser]))

(defn resource [r]
 (-> (Thread/currentThread)
     (.getContextClassLoader)
     (.getResource r)
     slurp))

(def hundy-names [
"James"
"John"
"Robert"
"Michael"
"William"
"David"
"Richard"
"Joseph"
"Thomas"
"Charles"
"Christopher"
"Daniel"
"Matthew"
"Anthony"
"Donald"
"Mark"
"Paul"
"Steven"
"Andrew"
"Kenneth"
"Joshua"
"Kevin"
"Brian"
"George"
"Edward"
"Ronald"
"Timothy"
"Jason"
"Jeffrey"
"Ryan"
"Jacob"
"Gary"
"Nicholas"
"Eric"
"Jonathan"
"Stephen"
"Larry"
"Justin"
"Scott"
"Brandon"
"Benjamin"
"Samuel"
"Frank"
"Gregory"
"Raymond"
"Alexander"
"Patrick"
"Jack"
"Dennis"
"Jerry"
"Tyler"
"Aaron"
"Jose"
"Henry"
"Adam"
"Douglas"
"Nathan"
"Peter"
"Zachary"
"Kyle"
"Walter"
"Harold"
"Jeremy"
"Ethan"
"Carl"
"Keith"
"Roger"
"Gerald"
"Christian"
"Terry"
"Sean"
"Arthur"
"Austin"
"Noah"
"Lawrence"
"Jesse"
"Joe"
"Bryan"
"Billy"
"Jordan"
"Albert"
"Dylan"
"Bruce"
"Willie"
"Gabriel"
"Alan"
"Juan"
"Logan"
"Wayne"
"Ralph"
"Roy"
"Eugene"
"Randy"
"Vincent"
"Russell"
"Louis"
"Philip"
"Bobby"
"Johnny"
                  "Bradley"
"Mary"
"Patricia"
"Jennifer"
"Linda"
"Elizabeth"
"Barbara"
"Susan"
"Jessica"
"Sarah"
"Karen"
"Nancy"
"Lisa"
"Margaret"
"Betty"
"Sandra"
"Ashley"
"Dorothy"
"Kimberly"
"Emily"
"Donna"
"Michelle"
"Carol"
"Amanda"
"Melissa"
"Deborah"
"Stephanie"
"Rebecca"
"Laura"
"Sharon"
"Cynthia"
"Kathleen"
"Amy"
"Shirley"
"Angela"
"Helen"
"Anna"
"Brenda"
"Pamela"
"Nicole"
"Samantha"
"Katherine"
"Emma"
"Ruth"
"Christine"
"Catherine"
"Debra"
"Rachel"
"Carolyn"
"Janet"
"Virginia"
"Maria"
"Heather"
"Diane"
"Julie"
"Joyce"
"Victoria"
"Kelly"
"Christina"
"Lauren"
"Joan"
"Evelyn"
"Olivia"
"Judith"
"Megan"
"Cheryl"
"Martha"
"Andrea"
"Frances"
"Hannah"
"Jacqueline"
"Ann"
"Gloria"
"Jean"
"Kathryn"
"Alice"
"Teresa"
"Sara"
"Janice"
"Doris"
"Madison"
"Julia"
"Grace"
"Judy"
"Abigail"
"Marie"
"Denise"
"Beverly"
"Amber"
"Theresa"
"Marilyn"
"Danielle"
"Diana"
"Brittany"
"Natalie"
"Sophia"
"Rose"
"Isabella"
"Alexis"
"Kayla"
"Charlotte"])

(defn search [list text]
  (prn (format "searching for '%s'" text))
  (if (nil? text)
    list
    (filter (fn [s] (clojure.string/includes?
                     (clojure.string/lower-case s)
                     (clojure.string/lower-case text)))
            list)))

(defroutes base-routes
  (GET "/" []
    (parser/render-file "templates/app.html"
                        {:forms-css (resource "reagent-forms.css")
                         :json-css (resource "json.human.css")}))
  (GET "/api*" [text]
       (noir/json (search hundy-names text)))
  (route/resources "/")
  (route/not-found "Not Found"))

(def app (app-handler [base-routes]
                      :ring-defaults {:params {:urlencoded true}}))
